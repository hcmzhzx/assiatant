<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>上传信息</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/index.css">
</head>
<body>
<form id="video-up" class="flexitemv wrap">
    <div class="flexitemv custombox">
        <div class="around upload">
            <div class="up-btn z-up">
                <input type="file" name="file" class="file" value="" accept="image/jpg"/>
            </div>
            <div class="c-text">上传视频，支持MP4、AVI格式，单个视频不可超过2G。</div>
        </div>
        <div class="flexv claimbox">
            <textarea class="flex claim" placeholder="请输入您需要的文案内容，请尽量详细。"></textarea>
            <textarea class="flex claim" placeholder="写下您的要求，我们会尽量满足您哦。"></textarea>
        </div>
    </div>
    <div class="flex center submit">
        <a href="javascript:;" class="flex center s-btn">确认提交</a>
    </div>
</form>
</body>
<script src="../js/icon.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
    /*点击的文本框*/
    $(".file").change(function() {//存放视频的父亲元素
        var videoContainer = $(this).parents(".upload"),file = document.querySelector('.file').files[0],delParent; //获取的视频文件
        var fileSize = 1024 * 1024 * 1024 * 2,windowURL = window.URL || window.webkitURL,videoURL = windowURL.createObjectURL(file);
        if(file.size <= fileSize){
            $('.up-btn').hide();
            var v_box = $(`<div class="z-up videobox"><video src="${videoURL}"></video></div>`);
            videoContainer.prepend(v_box);
            // 删除
            var $del = $('<i class="flex center del close-upimg"><svg class="zs" aria-hidden="true"><use xlink:href="#del"></use></svg></i>').on("click",function(event){
                event.preventDefault();
                event.stopPropagation();
                delParent = $(this).parent();
                delParent.parent().find(".up-btn").show();
                delParent.remove();
            });
            $del.appendTo(v_box);
            var video = $('.videobox').find('video')[0],can = document.createElement("canvas"),ctx = can.getContext('2d');
            video.remove();
            // 生成缩略图
            setTimeout(function () {
                can.width = video.videoWidth/2;
                can.height = video.videoHeight/2;
                ctx.drawImage(video, 0, 0, can.width, can.height);
                $('.videobox').append(`<img src="${can.toDataURL("image/jpeg")}" class="fitimg">`);
            },500);

            /*var time = setInterval(function () {
                if(videoContainer.find('img').attr('src').length>10){
                    v_box.removeClass('loading');
                    clearInterval(time);
                }
            },30)*/

        } else {
            alert('文件大小过大');
        }
    });
</script>
</html>